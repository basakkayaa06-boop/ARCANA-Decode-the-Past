<!doctype html>
<html lang="tr">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARCANA : Decode the Past</title>
  
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* --- TASARIM AYARLARI --- */
    * { box-sizing: border-box; font-family: 'Times New Roman', Times, serif; }
    
    body {
      margin: 0; padding: 0;
      height: 100vh; width: 100vw; 
      overflow: hidden;
      
      /* --- ARKA PLAN AYARLARI --- */
      background-color: #5D4037; 
      background-image: 
        url('resimler/octo.png'), /* Ahtapot Deseni */
        linear-gradient(135deg, rgba(93, 64, 55, 0.9) 0%, rgba(62, 39, 35, 0.95) 100%);
      
      /* Seyreklik ve Boyut Ayarƒ± */
      background-size: 450px 450px, cover; /* Ahtapotlarƒ± biraz b√ºy√ºt√ºp arayƒ± a√ßtƒ±k */
      background-repeat: repeat, no-repeat;
      
      /* Konumlandƒ±rma: Merkeze hizalƒ± */
      background-position: center center, center;
      
      /* Deseni zemine hafif√ße g√∂mme */
      background-blend-mode: soft-light;

      display: flex; justify-content: center; align-items: center;
      color: #2F1B14;
    }

    .game-container {
      width: 95%; max-width: 950px; height: 98vh;
      background: #F5E6D3; /* Par≈ü√∂men Rengi */
      border-radius: 15px;
      border: 4px solid #8B4513;
      box-shadow: 0 15px 60px rgba(0,0,0,0.95); /* G√∂lgeyi artƒ±rdƒ±m */
      display: flex; flex-direction: column;
      position: relative; padding: 15px;
      z-index: 10;
    }

    /* √úst Panel */
    .header-bar {
        display: flex; justify-content: space-around; align-items: center;
        background: #E8D5C4; padding: 8px 10px; border-radius: 10px;
        border: 2px solid #8B4513; margin-bottom: 10px; font-weight: bold; font-size: 1rem;
        flex-wrap: wrap;
    }

    .info-box-header {
        background: rgba(255,255,255,0.6); padding: 5px 10px;
        border-radius: 6px; border: 1px solid #Bcaaa4; margin: 2px;
    }

    /* Oyun Alanƒ± */
    .game-area {
      flex: 1; display: flex; flex-direction: column;
      overflow: hidden; 
      background: #fff; border-radius: 12px; border: 2px solid #D2691E;
      padding: 15px; position: relative;
    }

    /* G√∂rsel Kutusu */
    .image-box {
      flex: 1; min-height: 0; 
      background: #2c1810; border-radius: 8px;
      overflow: hidden; display: flex; align-items: center; justify-content: center;
      margin-bottom: 10px; border: 2px solid #5D4037; position: relative;
    }
    
    .image-box img { width: 100%; height: 100%; object-fit: contain; display: block; }

    /* Soru Metni */
    .question-text {
      font-size: 1.3rem; font-weight: bold; color: #8B4513;
      text-align: center; margin-bottom: 10px; flex-shrink: 0; min-height: 40px;
      display: flex; align-items: center; justify-content: center;
    }

    /* ≈ûƒ±klar */
    .options-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
      height: 110px; flex-shrink: 0; margin-bottom: 10px;
    }
    
    .opt-btn {
      background: #EFEBE9; border: 2px solid #8B4513; border-radius: 8px;
      color: #3E2723; font-weight: bold; cursor: pointer; font-size: 0.95rem;
      transition: all 0.1s; display: flex; align-items: center; justify-content: center;
      padding: 5px; text-align: center;
    }
    .opt-btn:hover:not(:disabled) { background: #D2691E; color: white; transform: translateY(-2px); }
    .opt-btn.correct { background: #4CAF50 !important; color: white; border-color: #2E7D32; }
    .opt-btn.incorrect { background: #f44336 !important; color: white; border-color: #C62828; }
    .opt-btn:disabled { opacity: 0.7; cursor: not-allowed; }
    .hint-highlight { box-shadow: 0 0 15px #4CAF50; border-color: #4CAF50; animation: pulse 1s infinite; }

    /* --- JOKER ALANI --- */
    .joker-container {
        display: flex; justify-content: center; gap: 15px; margin-bottom: 10px; flex-shrink: 0;
    }
    .joker-btn {
        background: #FFB300; color: #3E2723; border: 2px solid #FF6F00;
        border-radius: 50px; padding: 8px 15px; font-weight: bold; cursor: pointer;
        display: flex; align-items: center; gap: 5px; box-shadow: 0 4px 0 #E65100;
        transition: all 0.2s; font-size: 0.9rem;
    }
    .joker-btn:hover:not(:disabled) { transform: translateY(-2px); background: #FFC107; }
    .joker-btn:active:not(:disabled) { transform: translateY(2px); box-shadow: none; }
    .joker-btn:disabled { background: #Bcaaa4; color: #666; border-color: #8D6E63; box-shadow: none; cursor: default; opacity: 0.6; }

    /* Alt Panel */
    .bottom-bar {
        height: 70px; margin-top: auto; flex-shrink: 0;
        display: flex; align-items: center; justify-content: space-between;
        background: #EFEBE9; border-radius: 10px; padding: 5px 15px;
        border: 1px solid #ccc;
    }

    .info-text {
        font-size: 1rem; color: #333; flex: 1; margin-right: 15px;
        display: flex; align-items: center; height: 100%;
        font-family: 'Segoe UI', sans-serif; overflow-y: auto;
    }
    
    .info-success { color: #2E7D32; font-weight: bold; }
    .info-error { color: #C62828; font-weight: bold; }

    .next-btn {
        background: #8B4513; color: white; border: none; padding: 0 30px;
        height: 40px; font-size: 1rem; border-radius: 8px; 
        cursor: pointer; font-weight: bold; flex-shrink: 0;
        box-shadow: 0 4px 0 #5D4037; visibility: hidden;
    }
    .next-btn.visible { visibility: visible; }
    .next-btn:active { transform: translateY(4px); box-shadow: none; }

    /* Ekranlar ve Animasyonlar */
    .level-up-overlay {
        position: absolute; top:0; left:0; width:100%; height:100%;
        background: rgba(44, 24, 16, 0.95); color: #FFECB3;
        display: none; flex-direction: column; justify-content: center; align-items: center;
        z-index: 50; animation: fadeIn 0.5s; text-align: center; padding: 20px;
    }
    .overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(62, 39, 35, 0.98); z-index: 100;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      color: #F5E6D3; border-radius: 12px; text-align: center;
    }
    .hidden { display: none; }
    
    .big-btn {
        margin-top: 25px; padding: 15px 50px; font-size: 1.5rem;
        background: #D2691E; color: white; border: none; border-radius: 50px;
        cursor: pointer; font-weight: bold; box-shadow: 0 5px 0 #8B4513;
        transition: transform 0.2s;
    }
    .big-btn:hover { transform: scale(1.05); }

    /* --- DEƒûERLENDƒ∞RME BUTONU STƒ∞Lƒ∞ (G√úNCELLENDƒ∞) --- */
    .rate-btn {
        display: inline-block;
        margin-top: 25px; /* Mesafe artƒ±rƒ±ldƒ± */
        padding: 15px 40px; 
        font-size: 1.2rem;
        background: #0288D1; /* Parlak Mavi */
        color: white !important; 
        text-decoration: none; 
        border-radius: 50px;
        border: 2px solid #01579B;
        font-weight: bold; 
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        font-family: 'Segoe UI', sans-serif;
        cursor: pointer;
        z-index: 200; /* En √ºstte g√∂r√ºns√ºn */
        transition: all 0.2s;
    }
    .rate-btn:hover { transform: scale(1.05); background: #039BE5; }
    .rate-btn:active { transform: translateY(4px); box-shadow: none; }

    .sad-emoji { position: fixed; font-size: 4rem; pointer-events: none; z-index: 9999; animation: floatUp 2s ease-out forwards; }
    @keyframes floatUp { 0% { transform: translateY(0); opacity: 0; } 100% { transform: translateY(-100px); opacity: 0; } }
    @keyframes fadeIn { from {opacity:0} to {opacity:1}}
    @keyframes pulse { 0% { box-shadow: 0 0 5px #4CAF50; } 50% { box-shadow: 0 0 20px #4CAF50; } 100% { box-shadow: 0 0 5px #4CAF50; } }
  </style>
 </head>
 <body>

  <audio id="sndCorrect" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
  <audio id="sndWrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
  <audio id="sndLevelUp" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

  <div class="game-container">
    
    <div class="header-bar">
        <div class="info-box-header">SEVƒ∞YE: <span id="uiLevel" style="color:#D2691E">1</span>/3</div>
        <div class="info-box-header">SORU: <span id="qDisplay">1</span>/30</div>
        <div class="info-box-header" style="color:#8B4513; border-color:#8B4513; background:#fff;">
            ‚è±Ô∏è <span id="uiTimer">05:00</span>
        </div>
        <div class="info-box-header">PUAN: <span id="uiScore" style="color:#2E7D32">0</span> / 100</div>
        <div class="info-box-header"><span id="uiLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
    </div>

    <div class="game-area">
      <div class="image-box">
        <img id="gameImg" src="" alt="" onerror="this.style.display='none'">
      </div>

      <div class="question-text" id="qText">...</div>
      <div class="options-grid" id="optContainer"></div>

      <div class="joker-container">
          <button id="joker5050" class="joker-btn" onclick="useKarbon14()" title="Yanlƒ±≈ü iki ≈üƒ±kkƒ± eler">
              üß™ Karbon-14
          </button>
          <button id="jokerHint" class="joker-btn" onclick="useRehber()" title="Doƒüru cevabƒ± g√∂sterir">
              üìú Rehberin Notlarƒ±
          </button>
          <button id="jokerSkip" class="joker-btn" onclick="useYeniKatman()" title="Soruyu pas ge√ßer">
              ‚õèÔ∏è Yeni Katman
          </button>
      </div>

      <div class="bottom-bar">
          <div id="infoText" class="info-text"></div>
          <button id="nextBtn" class="next-btn" onclick="nextQuestion()">ƒ∞LERƒ∞ ‚û°Ô∏è</button>
      </div>
      
      <div id="levelUpScreen" class="level-up-overlay">
          <h1 style="font-size:2.5rem; color:#FFD700; margin-bottom:15px;">TEBRƒ∞KLER KA≈ûƒ∞F! üè∫</h1>
          <p style="font-size:1.4rem; color:#F5E6D3; margin-bottom:10px;">Bu a≈üamaya ula≈ütƒ±n, biraz daha √ßabala!</p>
          <p style="font-size:1rem; color:#81C784;">(S√ºre Yenilendi: 5 Dakika)</p>
      </div>
    </div>

    <div id="startScreen" class="overlay">
        <h1 style="font-size:3rem; margin-bottom:20px; text-shadow: 2px 2px 5px rgba(0,0,0,0.6);">ARCANA<br><span style="font-size:1.5rem">Decode the Past</span></h1>
        <p style="font-size:1.4rem; line-height: 1.6; max-width: 80%;">
            Haydi bakalƒ±m hafƒ±zamƒ±zƒ± tazeleyelim,<br>yeni bilgiler √∂ƒürenelim!
        </p>
        <button class="big-btn" onclick="startGame()">KAZIYA BA≈ûLA</button>
    </div>

    <div id="endScreen" class="overlay hidden">
        <h1 id="endTitle">OYUN Bƒ∞TTƒ∞</h1>
        <h2 id="endScore" style="font-size:3rem; color:#FFD700; text-shadow:0 0 10px #000;">0 Puan</h2>
        <p id="endMsg" style="margin-top:10px; font-size:1.3rem; font-weight:bold; padding:0 20px; color:#F5E6D3"></p>
        
        <button class="big-btn" onclick="location.reload()">BA≈ûA D√ñN</button>
        
        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeTnoEX1LFJdLEzwA_bjVyoVEQf9eDSGgOmyObGDI7iDZTJtg/viewform?usp=header" 
           target="_blank" 
           class="rate-btn">
           OYUNU DEƒûERLENDƒ∞R ‚≠ê
        </a>
    </div>
  </div>

  <script>
    const questions = [
      // --- SEVƒ∞YE 1 (10 Soru x 3 Puan) ---
      { file: "gobeklitepe.png", q: "Tarihin sƒ±fƒ±r noktasƒ± G√∂beklitepe hangi ilimizdedir?", opts: ["Mardin", "≈ûanlƒ±urfa", "Antep", "Diyarbakƒ±r"], a: 1, info: "G√∂beklitepe, 12.000 yƒ±llƒ±k ge√ßmi≈üiyle ≈ûanlƒ±urfa'dadƒ±r." },
      { file: "efes.png", q: "Efes Antik Kenti nerededir?", opts: ["ƒ∞zmir", "Aydƒ±n", "Muƒüla", "Antalya"], a: 0, info: "Efes, ƒ∞zmir'in Sel√ßuk il√ßesinde yer alƒ±r." },
      { file: "truva.png", q: "Truva Atƒ± ile √ºnl√º kent nerededir?", opts: ["Bursa", "Balƒ±kesir", "√áanakkale", "ƒ∞zmir"], a: 2, info: "Truva Sava≈üƒ±'nƒ±n ge√ßtiƒüi yer √áanakkale'dir." },
      { file: "nemrut.png", q: "Nemrut Daƒüƒ± heykelleri hangi ildedir?", opts: ["Malatya", "Adƒ±yaman", "Elazƒ±ƒü", "Van"], a: 1, info: "Kommagene Krallƒ±ƒüƒ±'na ait heykeller Adƒ±yaman'dadƒ±r." },
      { file: "pamukkale.png", q: "Pamukkale Hierapolis nerededir?", opts: ["Denizli", "Afyon", "Muƒüla", "Aydƒ±n"], a: 0, info: "Beyaz travertenler Denizli'dedir." },
      { file: "kapadokya.png", q: "Peri Bacalarƒ± (Kapadokya) hangi b√∂lgededir?", opts: ["Nev≈üehir", "Konya", "Kayseri", "Sivas"], a: 0, info: "Kapadokya'nƒ±n merkezi Nev≈üehir'dir." },
      { file: "sumela.png", q: "S√ºmela Manastƒ±rƒ± hangi ildedir?", opts: ["Rize", "Artvin", "Trabzon", "Ordu"], a: 2, info: "S√ºmela, Trabzon'un Ma√ßka il√ßesindedir." },
      { file: "kizkulesi.png", q: "Kƒ±z Kulesi hangi ilimizdedir?", opts: ["ƒ∞stanbul", "ƒ∞zmir", "√áanakkale", "Mersin"], a: 0, info: "Kƒ±z Kulesi ƒ∞stanbul Boƒüazƒ±'ndadƒ±r." },
      { file: "anitkabir.png", q: "Anƒ±tkabir hangi ilimizdedir?", opts: ["ƒ∞stanbul", "Ankara", "Samsun", "ƒ∞zmir"], a: 1, info: "Ulu √ñnder'in kabri ba≈ükent Ankara'dadƒ±r." },
      { file: "aspendos.png", q: "Aspendos Tiyatrosu nerededir?", opts: ["Muƒüla", "Mersin", "Antalya", "Hatay"], a: 2, info: "En iyi korunan antik tiyatro Antalya'dadƒ±r." },

      // --- SEVƒ∞YE 2 (10 Soru x 3 Puan) ---
      { file: "catalhoyuk.png", q: "√áatalh√∂y√ºk antik kenti nerededir?", opts: ["Konya", "Aksaray", "Ankara", "Karaman"], a: 0, info: "ƒ∞lk ≈üehir yerle≈üimi √áatalh√∂y√ºk Konya'dadƒ±r." },
      { file: "zeugma.png", q: "Zeugma Mozaik M√ºzesi nerededir?", opts: ["Hatay", "Gaziantep", "≈ûanlƒ±urfa", "Adana"], a: 1, info: "√áingene Kƒ±zƒ± mozaiƒüi Gaziantep'tedir." },
      { file: "hattusas.png", q: "Hitit ba≈ükenti Hattu≈üa≈ü nerededir?", opts: ["√áorum", "Yozgat", "Amasya", "Tokat"], a: 0, info: "Hititlerin ba≈ükenti √áorum, Boƒüazkale'dedir." },
      { file: "akdamar.png", q: "Akdamar Kilisesi hangi g√∂ldedir?", opts: ["Tuz G√∂l√º", "Bey≈üehir", "Van G√∂l√º", "Eƒüirdir"], a: 2, info: "Akdamar Adasƒ±, Van G√∂l√º √ºzerindedir." },
      { file: "bergama.png", q: "Bergama (Pergamon) nerededir?", opts: ["Manisa", "ƒ∞zmir", "Balƒ±kesir", "√áanakkale"], a: 1, info: "Bergama Krallƒ±ƒüƒ±'nƒ±n merkezi ƒ∞zmir'dedir." },
      { file: "gordion.png", q: "Kral Midas'ƒ±n mezarƒ± Gordion nerededir?", opts: ["Eski≈üehir", "K√ºtahya", "Afyon", "Ankara"], a: 3, info: "Frig ba≈ükenti Gordion, Ankara Polatlƒ±'dadƒ±r." },
      { file: "myra.png", q: "Noel Baba ile bilinen Myra nerededir?", opts: ["Antalya", "Muƒüla", "Mersin", "Isparta"], a: 0, info: "Myra (Demre) Antalya'dadƒ±r." },
      { file: "harran.png", q: "K√ºmbet evleriyle √ºnl√º Harran nerededir?", opts: ["Mardin", "≈ûanlƒ±urfa", "Batman", "Siirt"], a: 1, info: "Harran Evleri ≈ûanlƒ±urfa'dadƒ±r." },
      { file: "ishakpasa.png", q: "ƒ∞shak Pa≈üa Sarayƒ± nerededir?", opts: ["Kars", "Erzurum", "Aƒürƒ±", "Iƒüdƒ±r"], a: 2, info: "ƒ∞shak Pa≈üa Sarayƒ± Aƒürƒ±'nƒ±n Doƒüubayazƒ±t il√ßesindedir." },
      { file: "hasankeyf.png", q: "Ilƒ±su Barajƒ± altƒ±nda kalan Hasankeyf nerededir?", opts: ["Mardin", "Batman", "Diyarbakƒ±r", "Siirt"], a: 1, info: "Tarihi Hasankeyf Batman'dadƒ±r." },

      // --- SEVƒ∞YE 3 (10 Soru x 4 Puan) ---
      { file: "giza.png", q: "Giza Piramitleri hangi √ºlkededir?", opts: ["Mƒ±sƒ±r", "Fas", "Tunus", "Sudan"], a: 0, info: "Piramitler Mƒ±sƒ±r'ƒ±n ba≈ükenti Kahire'dedir." },
      { file: "cinseddi.png", q: "√áin Seddi'ni ba≈ülatan imparator kimdir?", opts: ["Qin Shi Huang", "Ming", "Han", "Tang"], a: 0, info: "√áin'in ilk imparatoru Qin Shi Huang ba≈ülatmƒ±≈ütƒ±r." },
      { file: "machupicchu.png", q: "Machu Picchu hangi √ºlkededir?", opts: ["Meksika", "≈ûili", "Peru", "Brezilya"], a: 2, info: "ƒ∞nka ≈üehri Machu Picchu, Peru'dadƒ±r." },
      { file: "petra.png", q: "Kayalara oyulu Petra antik kenti nerededir?", opts: ["√úrd√ºn", "L√ºbnan", "Suriye", "Mƒ±sƒ±r"], a: 0, info: "G√ºl kƒ±rmƒ±zƒ±sƒ± ≈üehir Petra, √úrd√ºn'dedir." },
      { file: "kolezyum.png", q: "Kolezyum (Colosseum) hangi ≈üehirdedir?", opts: ["Atina", "Roma", "Milano", "Venedik"], a: 1, info: "Dev arena Kolezyum, Roma'dadƒ±r." },
      { file: "stonehenge.png", q: "Stonehenge hangi √ºlkededir?", opts: ["ƒ∞rlanda", "ƒ∞sko√ßya", "ƒ∞ngiltere", "Galler"], a: 2, info: "Dev ta≈ü √ßemberi Stonehenge, ƒ∞ngiltere'dedir." },
      { file: "moai.png", q: "Moai heykelleri (Paskalya Adasƒ±) kime aittir?", opts: ["≈ûili", "Peru", "Arjantin", "Avustralya"], a: 0, info: "Paskalya Adasƒ± ≈ûili devletine baƒülƒ±dƒ±r." },
      { file: "tacmahal.png", q: "Tac Mahal hangi √ºlkededir?", opts: ["Pakistan", "Hindistan", "ƒ∞ran", "Banglade≈ü"], a: 1, info: "A≈ükƒ±n anƒ±tƒ± Tac Mahal Hindistan'dadƒ±r." },
      { file: "chichenitza.png", q: "Maya piramidi Chichen Itza nerededir?", opts: ["Meksika", "Peru", "Brezilya", "Kolombiya"], a: 0, info: "Chichen Itza, Meksika'daki Maya kentidir." },
      { file: "parthenon.png", q: "Akropolis'teki Parthenon tapƒ±naƒüƒ± nerededir?", opts: ["Roma", "Atina", "Selanik", "Girit"], a: 1, info: "Parthenon, Yunanistan'ƒ±n ba≈ükenti Atina'dadƒ±r." }
    ];

    let idx = 0;
    let score = 0;
    let lives = 5;
    let time = 300; // 5 Dakika
    let timer;
    // Joker Durumlarƒ±
    let joker5050Used = false;
    let jokerHintUsed = false;
    let jokerSkipUsed = false;

    const imgEl = document.getElementById('gameImg');
    const qEl = document.getElementById('qText');
    const optEl = document.getElementById('optContainer');
    const infoText = document.getElementById('infoText');
    const nextBtn = document.getElementById('nextBtn');
    const levelUpScreen = document.getElementById('levelUpScreen');
    // Joker Butonlarƒ±
    const btn5050 = document.getElementById('joker5050');
    const btnHint = document.getElementById('jokerHint');
    const btnSkip = document.getElementById('jokerSkip');
    
    function playSound(type) {
        const audio = document.getElementById(type === 'correct' ? 'sndCorrect' : (type === 'levelUp' ? 'sndLevelUp' : 'sndWrong'));
        audio.currentTime = 0;
        audio.play().catch(e => {});
    }

    function startGame() {
        document.getElementById('startScreen').classList.add('hidden');
        startTimer();
        loadQuestion();
    }

    function startTimer() {
        if (timer) clearInterval(timer);
        timer = setInterval(() => {
            time--;
            let m = Math.floor(time / 60);
            let s = time % 60;
            document.getElementById('uiTimer').innerText = `${m}:${s<10?'0'+s:s}`;
            if (time <= 0) {
                clearInterval(timer);
                endGame();
            }
        }, 1000);
    }

    function loadQuestion() {
        nextBtn.classList.remove('visible');
        infoText.innerHTML = '';
        
        // Seviye Atlama
        if (idx === 10 || idx === 20) {
            time = 300; 
            document.getElementById('uiTimer').innerText = "5:00";
            showLevelUp();
        }

        if (idx >= questions.length) {
            endGame(true);
            return;
        }

        const data = questions[idx];
        qEl.innerText = data.q;
        
        imgEl.style.display = 'block';
        imgEl.src = "resimler/" + data.file;
        imgEl.onload = () => { imgEl.style.opacity = '1'; };
        imgEl.onerror = () => { imgEl.style.display = 'none'; }; 
        
        optEl.innerHTML = "";
        let indices = [0, 1, 2, 3];
        indices.sort(() => Math.random() - 0.5);

        indices.forEach(i => {
            let btn = document.createElement("button");
            btn.className = "opt-btn";
            btn.innerText = data.opts[i];
            btn.onclick = () => checkAnswer(i, data.a, btn, data);
            optEl.appendChild(btn);
        });

        let currentLevel = 1;
        if (idx >= 10) currentLevel = 2;
        if (idx >= 20) currentLevel = 3;
        
        document.getElementById('uiLevel').innerText = currentLevel;
        document.getElementById('qDisplay').innerText = idx + 1;
    }

    function showLevelUp() {
        playSound('levelUp');
        levelUpScreen.style.display = 'flex';
        setTimeout(() => {
            levelUpScreen.style.display = 'none';
        }, 3000);
    }

    // --- JOKER FONKSƒ∞YONLARI ---
    function useKarbon14() {
        if (joker5050Used || nextBtn.classList.contains('visible')) return;
        
        const data = questions[idx];
        const allBtns = Array.from(document.querySelectorAll('.opt-btn'));
        const incorrectBtns = allBtns.filter(btn => btn.innerText !== data.opts[data.a]);
        
        incorrectBtns.sort(() => Math.random() - 0.5);
        incorrectBtns.slice(0, 2).forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = '0.3';
        });

        joker5050Used = true;
        btn5050.disabled = true;
    }

    function useRehber() {
        if (jokerHintUsed || nextBtn.classList.contains('visible')) return;

        const data = questions[idx];
        const allBtns = document.querySelectorAll('.opt-btn');
        allBtns.forEach(btn => {
            if (btn.innerText === data.opts[data.a]) {
                btn.classList.add('hint-highlight');
            }
        });

        jokerHintUsed = true;
        btnHint.disabled = true;
    }

    function useYeniKatman() {
        if (jokerSkipUsed || nextBtn.classList.contains('visible')) return;
        
        jokerSkipUsed = true;
        btnSkip.disabled = true;
        
        idx++;
        loadQuestion();
    }
    // ---------------------------

    function checkAnswer(selected, correct, btn, data) {
        if (nextBtn.classList.contains('visible')) return;

        const allBtns = document.querySelectorAll('.opt-btn');
        let pointsToAdd = 3; 
        if (idx >= 20) pointsToAdd = 4;

        if (selected === correct) {
            btn.classList.add('correct');
            playSound('correct');
            score += pointsToAdd;
            document.getElementById('uiScore').innerText = score;
            infoText.innerHTML = "<span class='info-success'>‚úÖ DOƒûRU!</span>";
            triggerConfetti();
        } else {
            btn.classList.add('incorrect');
            playSound('wrong');
            lives--;
            document.getElementById('uiLives').innerText = "‚ù§Ô∏è".repeat(Math.max(0, lives));
            
            infoText.innerHTML = `<span class='info-error'>‚ùå YANLI≈û!</span> ${data.info}`;
            triggerSadFaces();

            allBtns.forEach(b => {
                if (b.innerText === data.opts[correct]) b.classList.add('correct');
            });

            if (lives <= 0) {
                setTimeout(() => endGame(false), 2500); 
                return;
            }
        }

        allBtns.forEach(b => b.disabled = true);
        nextBtn.classList.add('visible');
    }

    function nextQuestion() {
        idx++;
        loadQuestion();
    }

    function endGame(isWin) {
        clearInterval(timer);
        document.getElementById('endScreen').classList.remove('hidden');
        document.getElementById('endTitle').innerText = isWin ? "OYUN Bƒ∞TTƒ∞" : "OYUN Bƒ∞TTƒ∞";
        document.getElementById('endScore').innerText = score + " Puan";
        
        let msg = "";
        if (score === 100) {
            msg = "TEBRƒ∞KLER KA≈ûƒ∞F! üè∫\nMuhte≈üem bir hafƒ±zan var, t√ºm hazineleri buldun!";
        } else if (score >= 80) {
            msg = "Harika ƒ∞≈ü! Neredeyse t√ºm sƒ±rlarƒ± √ß√∂zd√ºn.";
        } else {
            msg = "G√ºzel √ßaba, ama biraz daha ara≈ütƒ±rmalƒ±sƒ±n.";
        }
        
        document.getElementById('endMsg').innerText = msg;
        if(isWin) triggerConfetti();
    }

    function triggerConfetti() {
        if (typeof confetti === 'function') confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    function triggerSadFaces() {
        const emojis = ['üò¢', 'üíî', 'üò≠', '‚òπÔ∏è', '‚ùå'];
        for (let i = 0; i < 5; i++) {
            const el = document.createElement('div');
            el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            el.className = 'sad-emoji';
            el.style.left = (Math.random() * 80 + 10) + 'vw'; 
            el.style.top = (Math.random() * 50 + 40) + 'vh';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 2000);
        }
    }
  </script>
 </body>

</html>


